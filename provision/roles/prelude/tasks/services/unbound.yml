---
- name: install unbound service
  nix: name=unbound state=latest
  register: unbound_installed

- name: updating unbound configurations
  copy:
    src: usr/local/etc/unbound/unbound.conf
    dest: /usr/local/etc/unbound/unbound.conf
  register: unbound_configured

- name: enabling unbound service
  copy:
    src: home/Library/LaunchAgents/net.unbound.unbound.plist
    dest: ~/Library/LaunchAgents/net.unbound.unbound.plist
  register: unbound_enabled

- name: ensuring resolver directory
  become: yes
  file:
    path: /etc/resolver
    state: directory

- name: adding dev resolvers
  become: yes
  copy:
    src: etc/resolver/dev
    dest: /etc/resolver/dev

- name: unloading unbound service
  command: launchctl unload ~/Library/LaunchAgents/net.unbound.unbound.plist
  ignore_errors: yes
  when: "unbound_installed.changed or unbound_configured.changed or unbound_enabled.changed"

- name: loading unbound service
  command: launchctl load ~/Library/LaunchAgents/net.unbound.unbound.plist
  ignore_errors: yes
  when: "unbound_installed.changed or unbound_configured.changed or unbound_enabled.changed"
