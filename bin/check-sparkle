#!/bin/bash

printf "\033[1;1m%-8s %-8s %s\033[0;0m\n" "Default" "User" "Bundle ID"

installed_apps=$(system_profiler SPApplicationsDataType |sed -n 's/^ *Location: \/Applications\/\(.*\)/\1/p')
sparkle_key="SUEnableAutomaticChecks"

while read -r app_relative_path; do
    app_path="/Applications/${app_relative_path}"
    info_plist="${app_path}/Contents/Info.plist"

    if [ -f "${app_path}/Contents/_MASReceipt/receipt" ]; then
        continue
    fi

    app_sparkle_default=$(defaults read "${info_plist}" "${sparkle_key}" 2>/dev/null)
    if [ "${app_sparkle_default}" = "" ]; then
        continue
    fi

    case "${app_sparkle_default}" in
        1|YES|TRUE)
            app_sparkle_default=true
            ;;
        0|NO|FALSE)
            app_sparkle_default=false
            ;;
    esac

    app_bundle_id=$(defaults read "${info_plist}" "CFBundleIdentifier")
    app_sparkle_user=$(defaults read "${app_bundle_id}" "${sparkle_key}" 2>/dev/null)

    case "${app_sparkle_user}" in
        1|YES|TRUE)
            app_sparkle_user=true
            ;;
        0|NO|FALSE)
            app_sparkle_user=false
            ;;
    esac

    printf "%-8s %-8s %s\n" "${app_sparkle_default}" "${app_sparkle_user}" "${app_bundle_id}"
done <<< "$installed_apps"
